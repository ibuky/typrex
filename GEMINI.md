# プロジェクト概要

これは、Vue.js を使用してモダンな Web アプリケーションを構築するためのフレームワークである Nuxt.js プロジェクトです。このプロジェクトは、UI コンポーネントに TypeScript と `@nuxt/ui` モジュールを使用するように設定されています。

メインのアプリケーションエントリポイントは `app/app.vue` で、現在はデフォルトの Nuxt ウェルカムページが表示されています。プロジェクトの設定は `nuxt.config.ts` で管理されています。

## 主要技術スタック

*   **Nuxt.js:** Vue.js ベースのフレームワーク。サーバーサイドレンダリング (SSR) や静的サイト生成 (SSG) に対応し、ファイルベースのルーティングなどの機能を提供します。
*   **Vue.js:** コンポーネントベースのUI構築のためのプログレッシブJavaScriptフレームワークです。
*   **TypeScript:** JavaScriptに静的型付けを追加した言語で、コードの堅牢性と開発効率を向上させます。
*   **@nuxt/ui:** Tailwind CSSをベースにしたUIコンポーネントライブラリ。高品質なUIを迅速に構築するために利用します。

## ビルドと実行

### インストール

プロジェクトの依存関係をインストールするには、次のいずれかのコマンドを実行します。

```bash
npm install
```

### 開発

開発サーバーを起動するには、次のコマンドを実行します。サーバーは `http://localhost:3000` で利用可能になります。

```bash
npm run dev
```

### 本番

本番用にアプリケーションをビルドするには、次のコマンドを使用します。

```bash
npm run build
```

本番ビルドをローカルでプレビューするには、次のコマンドを実行します。

```bash
npm run preview
```

## ディレクトリ構造

```
/
├── app/
│   └── app.vue         # ルートコンポーネント (全てのページに適用)
├── components/         # (推奨) 再利用可能なVueコンポーネント
├── layouts/            # (推奨) ページレイアウト
├── pages/              # (推奨) ファイルベースのルーティングでページを作成
├── public/             # 静的ファイル (画像、フォントなど)
├── server/             # (推奨) サーバーサイドのロジック (APIルートなど)
├── nuxt.config.ts      # Nuxt.jsの設定ファイル
└── package.json        # プロジェクトの依存関係とスクリプト
```

## 開発規約
*   **フレームワーク:** このプロジェクトでは Nuxt.js を使用しています。Nuxt.js の規約とベストプラクティスに従ってください。
*   **言語:** プロジェクトは TypeScript でセットアップされています。新しいコードはすべて TypeScript で記述する必要があります。
*   **UI:** `@nuxt/ui` モジュールがインストールされているため、ユーザーインターフェースの構築にはそのコンポーネントを使用することが推奨されます。
*   **コーディングスタイル:** PrettierやESLintなどのフォーマッタ/リンタを導入し、コードの一貫性を保つことを推奨します。

## 開発内容
- 日本語向けタイピングゲーム
  - 問題の日本語の単語に対してタイピング文字を提供する。

## 判定モジュールを作成する

日本語タイピングの正誤判定を行うためのコアモジュール。ユーザーからの1アルファベットごとの入力を評価し、即座にフィードバックを返す責務を持つ。

### 1. かな-ローマ字変換テーブルの設計

本モジュールの根幹となる、かな一音に対して考えられる全てのローマ字表記をマッピングしたデータ構造。

*   **目的:** マイナーな入力方法を含め、あらゆるローマ字表記を網羅した変換テーブルを作成する。これがタイピングの多様な入力を受け付けるための基盤となる。
*   **形式:** オブジェクトまたはMap形式を推奨。
    *   キー: `か`, `きゃ`, `ん` などの音の単位（string）
    *   バリュー: 対応するローマ字表記の配列（string[]）
*   **例:**
    ```json
    {
      "あ": ["a"],
      "か": ["ka", "ca"],
      "し": ["shi", "si", "ci"],
      "ちゃ": ["cha", "tya", "cya"],
      "ん": ["n", "nn", "xn"],
      "てぃ": ["thi", "texi"],
      "うぁ": ["wha", "uxa"]
    }
    ```

*   **課題と方針:**
    *   **網羅性の確保:** 「完全に網羅する」という要件を満たすため、JIS X 4063などの規格や、主要なIME（Google日本語入力、Microsoft IMEなど）、既存のタイピングソフトの挙動を徹底的に調査し、対応パターンを洗い出す必要がある。
    *   **データ構造:** 促音「っ」や「ん」の後に続く文字によって入力方法が変わるパターン（例: `katt`**`a`**, `sa`**`nn`**`i`）に対応できるようなデータ構造、あるいはロジックの工夫が必要となる。

### 2. 入力判定ロジック

1アルファベットごとの入力に対し、現在の入力状態を判定する。

*   **関数（例）:** `validateInput(currentInput: string, targetRomanizations: string[]): 'correct' | 'in-progress' | 'incorrect'`
*   **引数:**
    *   `currentInput`: 現在の音に対してユーザーが入力した文字列（例: `k`, `ka`）。
    *   `targetRomanizations`: 変換テーブルから取得した、正解となるローマ字表記の配列（例: `["ka", "ca"]`）。
*   **戻り値:**
    *   `'correct'`: `currentInput` が `targetRomanizations` のいずれかと完全に一致する場合。
    *   `'in-progress'`: `targetRomanizations` のいずれかの前方部分文字列と `currentInput` が一致する場合。（例: `target`が`["ka", "ca"]`、`input`が`"k"`や`"c"`）
    *   `'incorrect'`: 上記のいずれでもない場合。

*   **処理フローの例（「か」をタイプする場合）:**
    1.  問題「か」に対応するローマ字配列 `["ka", "ca"]` を取得。
    2.  ユーザーが `k` を入力。`validateInput("k", ["ka", "ca"])` を呼び出し、`'in-progress'` を受け取る。
    3.  ユーザーが `a` を入力。`validateInput("ka", ["ka", "ca"])` を呼び出し、`'correct'` を受け取る。次の問題へ。

### 3. 実装場所の候補

*   `utils/typingLogic.ts`: プロジェクト全体で再利用可能な純粋な関数群として実装する場合に最適。
*   `composables/useTyping.ts`: Vueコンポーネントからリアクティブな状態（入力中の文字列など）と共に利用する場合。

## テストを作成する

判定モジュールのロジックと、かな-ローマ字変換テーブルの網羅性・正確性を保証するためのテストを設計・実装する。

### 1. テスト方針

*   **フレームワーク:** Nuxt.jsプロジェクトと親和性の高い `vitest` の利用を推奨。
*   **テスト対象:**
    1.  `validateInput` 関数（入力判定ロジック）
    2.  かな-ローマ字変換テーブルのデータそのもの
*   **構成:**
    *   テストケースは、入力の種類（基本、拗音、促音、撥音など）ごとに `describe` ブロックで整理する。
    *   かな-ローマ字変換テーブルをループ処理し、定義されたすべての表記が正しく判定されることを確認する**データ駆動テスト**を主軸に据える。

### 2. テストケースの例

#### a. 基本入力のテスト

*   **目的:** 五十音の基本的な入力パターンをテストする。
*   **ケース:**
    *   「か」に対し `k` -> `'in-progress'`, `ka` -> `'correct'`, `ca` -> `'correct'`
    *   「し」に対し `s` -> `'in-progress'`, `si` -> `'correct'`, `sh` -> `'in-progress'`, `shi` -> `'correct'`
    *   「か」に対し `z` -> `'incorrect'`

#### b. 拗音（「きゃ」「しょ」など）のテスト

*   **目的:** 小さい「ゃ」「ゅ」「ょ」を含む音のパターンを網羅する。
*   **ケース:**
    *   「ちゃ」に対し `t` -> `'in-progress'`, `ty` -> `'in-progress'`, `tya` -> `'correct'`
    *   「ちゃ」に対し `c` -> `'in-progress'`, `ch` -> `'in-progress'`, `cha` -> `'correct'`
    *   「じゃ」に対し `j` -> `'in-progress'`, `ja` -> `'correct'`, `zy` -> `'in-progress'`, `zya` -> `'correct'`

#### c. 促音（「っ」）のテスト

*   **目的:** 後続の文字によって入力方法が変わる促音のパターンを網羅する。
*   **ケース:**
    *   「かった」(`katta`): `k` `a` `t` `t` `a` の各ステップで状態が正しく遷移することを確認。
    *   「かった」に対し `katt` -> `'in-progress'`, `katta` -> `'correct'`
    *   代替表記 `xtu`, `xtsu` なども正しく判定されることを確認。

#### d. 撥音（「ん」）のテスト

*   **目的:** 後続の文字によって入力方法が変わる「ん」のパターンを網羅する。
*   **ケース:**
    *   **n+子音:** 「かんい」(`kanni`): `k` `a` `n` `n` `i` の各ステップ。
    *   **n+母音/や行:** 「けんい」(`ken'i` or `kenn`): `kenn` で `ken` までが確定すること、`ken'` で `ken` が確定することを確認。
    *   **単体の「ん」:** 文末の「ん」が `n`, `nn`, `xn` で入力できることを確認。

#### e. 特殊音・マイナー表記のテスト

*   **目的:** 「てぃ」「ふぁ」などの外来音や、一般的でないローマ字表記が仕様通り動作することを確認する。
*   **ケース:**
    *   「てぃ」に対し `t` -> `'in-progress'`, `th` -> `'in-progress'`, `thi` -> `'correct'`
    *   「てぃ」に対し `t` `e` `x` `i` の各ステップ。

### 3. 実装場所の候補

*   `tests/typingLogic.spec.ts`: `vitest` を使用する場合のテストファイル配置場所の例。
